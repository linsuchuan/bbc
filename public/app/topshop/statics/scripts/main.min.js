var dragDom=function(a){function c(a){this.style.opacity="1";dragSrcEl=this;a.dataTransfer.effectAllowed="move";a.dataTransfer.setData("innerhtml",this.innerHTML)}function b(a){this.classList.add("over")}function d(a){this.classList.remove("over")}function g(a){a.preventDefault&&a.preventDefault();return!1}function f(a){dragSrcEl!=this&&(dragSrcEl.innerHTML=this.innerHTML,this.innerHTML=a.dataTransfer.getData("innerhtml"));return!1}function e(a){this.style.opacity="1";[].forEach.call(divs,function(a){a.classList.remove("over")})}
a=document.querySelectorAll(a);[].forEach.call(a,function(a){a.addEventListener("dragstart",c,!1);a.addEventListener("dragenter",b,!1);a.addEventListener("dragover",g,!1);a.addEventListener("dragleave",d,!1);a.addEventListener("drop",f,!1);a.addEventListener("dragend",e,!1)})};function isBody(a){return/^(?:body|html)$/i.test(a.tagName)}function getCompatElement(){var a=document;return a.compatMode&&"CSS1Compat"!=a.compatMode?a.body:a.html}document.head=document.head||document.getElementsByTagName("head")[0];function isElement(a){a=a[0]||a;return a.nodeName&&1===a.nodeType}function substitute(a,c){return String(a).replace(/\\?\{([^{}]+)\}/g,function(a,d){return"\\"===a.charAt(0)?a.slice(1):null!=c[d]?c[d]:""})}
function checkAll(a,c){$(c).prop("checked",$(a).prop("checked"))}$.fn.outerHtml=function(){if("outerHTML"in document.body){var a="";this.each(function(c){a+=this.outerHTML});return a}return $("<div>").append(this.clone(!0,!0)).html()};
$.fn.patch=function(a){var c=this,b;b=a?$.makeArray(a):["margin","padding","border"];var d={x:0,y:0};$.each({x:["left","right"],y:["top","bottom"]},function(a,f){$.each(f,function(f,h){try{$.each(b,function(b,f){f+="-"+h;0==f.indexOf("border")&&(f+="-width");d[a]+=parseInt(c.css(f))||0})}catch(n){}})});return d};
$.fn.locate=function(a){a=$.extend({relative:document.body,x:"center",y:"center"},a);var c=$(a.relative),b,d=$(this).css("position","absolute"),g=d.height();b=d.width();var f=(c.is("body")?$(window):c).innerHeight(),e=c.innerWidth();switch(a.x){case 0:case "left":b=0;break;case "right":b=e-b;break;default:b=parseInt((e-b)/2)}switch(a.y){case 0:case "top":a=0;break;case "bottom":a=f-g;break;default:a=parseInt((f-g)/2)}d.css({left:Math.max(0,Math.floor(b+(c.offset()?c.offset().left:0)+c.scrollLeft())),
top:Math.max(0,Math.floor(a+(c.offset()?c.offset().top:0)+c.scrollTop()))});return this};
var Class=function(a){var c=function(){"function"===typeof this.init&&this.init.apply(this,arguments)};c.prototype=a||{};c.prototype.setOptions=function(){this.options=$.extend.apply(null,[!0,{},this.options].concat($.makeArray(arguments)));return this};c.prototype.trigger=function(a,d){a=this.options[a]||this.options["on"+a.replace(/^[a-z]/g,function(a){return a.toUpperCase()})];"function"===typeof a&&a.apply(this,$.makeArray(d));return this};return c};
(function(){var a,c,b=window.console;window.log=a=function(){c.push(arguments);b?b.log[b.firebug?"apply":"call"](b,Array.prototype.slice.call(arguments)):alert(Array.prototype.slice.call(arguments).join("\n"))};a.history=c=[]})();var imageUpload=function(a){function c(){for(var a=$(".img-show a"),d=0;d<a.length;d++)for(var b=0;b<h.length;b++)0<=h[b].img_id.indexOf($(a[d]).attr("href"))&&$(a[d]).parent().parent().addClass("checked")}a=$.extend({url:"",target:document.body,fileName:"upload_files",inputName:"images[]",size:512E3,width:50,height:50,multiple:!0,isModal:!1,limit:0,handle:".action-upload",file_input:".action-file-input",insertWhere:null,callback:null},a||{});var b,d,g,f,e,h=[];$(a.target).on("click",a.handle,function(d){$(this).parent().find(a.file_input).click()}).on("change",
a.file_input,function(d){var b=$(this);d=b.parent();var c=d.find(a.handle),f=this.getAttribute("data-filename")||a.fileName,e=this.getAttribute("data-size"),e=Number(e)||a.size,w=d.find(this.getAttribute("data-insertwhere")||a.insertWhere||".image-box"),v=this.multiple,h=this.getAttribute("data-ismodal"),B=this.getAttribute("data-remote")||a.url,z=this.getAttribute("data-max")||a.limit,s=this.getAttribute("name")||a.inputName,k=this.getAttribute("data-callback")||b.data("callback")||a.callback,u=
new FormData,m=this.files;if(z&&d.find(".img-thumbnail:not(.action-upload)").length+(v&&m?m.length:1)>z)return alert("超出限制，最多上传"+z+"张。"),!1;if(!m||!Array.prototype.slice.call(m).every(function(a,d){if(a.size>e)return $("#messagebox").message('抱歉，上传图片 "'+a.name+'" 须小于'+e/1024+"kB!"),b.val(""),!1;v?u.append(f+"[]",a):u.append(f,a);return!0}))return!1;$.ajax({url:B,type:"POST",data:u,cache:!1,contentType:!1,processData:!1,success:function(a){try{a=JSON.parse(a)}catch(d){}if(a.success&&a.data){if(k)return k(a);
var e="";if(v)if(h){var n=c.parents(".modal");$("#areaselect_modal").modal("hide");n.find(".nav-tabs .active").attr("data-type");n.find(".has-searched")&&$(".has-searched").val();n.find(".gallery-condition .active").hasClass("time")?(n.find(".gallery-condition .active").attr("data-order"),n.find(".gallery-condition .active").attr("data-sort")):n.find(".gallery-condition .active").attr("data-order");$.each(a.data,function(a,d){d.url&&(e=0>=b.parents(".note-image-dialog").length?g&&"true"==g?e+('<div class="col-sm-3"><div class="thumbnail checked"><div class="img-show"><a href='+
d.url+'"><img src="'+d.t_url+'"></a></div><div class="caption" data-name="'+d.url+'" data-url="'+d.url+'"><p class="image-name">'+d.image_name+"</p></div></div></div>"):e+('<div class="col-sm-3"><div class="thumbnail"><div class="img-show"><a href='+d.url+'"><img src="'+d.t_url+'"></a></div><div class="caption" data-name="'+d.url+'" data-url="'+d.url+'"><p class="image-name">'+d.image_name+"</p></div></div></div>"):e+('<div class="col-sm-3"><div class="thumbnail"><div class="img-show"><a href='+d.url+
'"><img src="'+d.t_url+'"></a></div><div class="caption" data-name="'+d.url+'" data-url="'+d.url+'"><p class="image-name">'+d.image_name+"</p></div></div></div>"))});$(e).insertBefore($(".gallery > div:first-child"))}else w=c,$.each(a.data,function(a,d){d.url&&(e+='<div class="handle img-thumbnail"><i class="icon-close-b" onclick="$(this).parent().remove();"></i><img src="'+d.url+'"><input type="hidden" name="'+s+'" value="'+d.image_id+'"></div>')}),$(e).insertBefore(w);else a=a.data[f],a.url&&(e=
'<img src="'+a.url+'"><input type="hidden" name="'+s+'" value="'+a.image_id+'">'),$(w).html(e)}else a.message&&($("#messagebox").message(a.message),b.val(""))},error:function(){$("#messagebox").message("上传出错，请重试")}})});$("#gallery_modal").on("shown.bs.modal",function(a){h=[];b=$(a.relatedTarget);d=b.attr("data-limit");g=b.attr("data-isMultiple");f=b.attr("data-name");b.parents(".multiple-upload").find(".multiple-item");e=b.parent().find(".multiple-item");$(this).attr("data-ids",h);e&&($(e).each(function(a,
d){var b={};b.img_id=$(d).find('input[name^="list"]').val();b.img_src=$(d).find("img").attr("src");h.push(b)}),c())}).on("click",".gallery-modal-tabs li a",function(a){a.preventDefault();var d=$(this);$(this).parent().addClass("active").siblings(".active").removeClass("active");a=$(this).attr("href");$.post(a,function(a){d.parents(".nav-tabs-custom").find(".gallery-modal-content").empty().append(a);c()})}).on("click",".action-save",function(){if(g&&"true"==g){var a="",c=h;$("#gallery_modal").find(".thumbnail.checked").each(function(){var a=
!1,d={};d.img_id=$(this).find(".caption").attr("data-name");d.img_src=$(this).find(".caption").attr("data-url");for(var b=0;b<h.length;b++)0<=h[b].img_id.indexOf(d.img_id)&&(a=!0);a||c.push(d)});for(var e=0;e<c.length;e++)a+='<div class="multiple-item"><div class="multiple-del glyphicon glyphicon-remove-circle"></div><a class="select-image"><input type="hidden" name="'+f+'" value="'+c[e].img_id+'"><div class="img-put"><img src="'+c[e].img_src+'"><i class="glyphicon glyphicon-picture"></i></div></a></div>';
0==c.length?$("#messagebox").message("请选择图片!"):c.length>d?$("#messagebox").message("您选择得图片数量超出最大限制!"):(b.parents(".multiple-upload").find(".multiple-item").remove(),$("#gallery_modal").modal("hide"),b.before(a),dragDom(".multiple-item"))}else{var a=$("#gallery_modal").find(".checked"),l=a.find("img").attr("src"),e=a.find(".caption").attr("data-name"),l='<img src="'+l+'">';0<a.length?(b.find(".img-put").empty().append(l),b.find("input").val(e),$("#gallery_modal").modal("hide")):$("#messagebox").message("请选择图片!")}}).on("hide.bs.modal",
function(a){$(this).removeData("bs.modal")}).on("click",".thumbnail",function(a){a.preventDefault();a={};a.img_id=$(this).find(".caption").attr("data-name");a.img_src=$(this).find(".caption").attr("data-url");if(g&&"true"==g)if($(this).toggleClass("checked"),$(this).hasClass("checked"))h.push(a);else for(var d=0;d<h.length;d++)h[d].img_id==a.img_id&&h.splice(d,1);else $(this).addClass("checked").parent().siblings().find(".thumbnail").removeClass("checked")}).on("click",".pagination a",function(a){a.preventDefault();
if(!$(this).parent().hasClass("disabled")){var d=h;$("#gallery_modal").find(".thumbnail.checked").each(function(){var a=!1,b={};b.img_id=$(this).find(".caption").attr("data-name");b.img_src=$(this).find(".caption").attr("data-url");for(var c=0;c<d.length;c++)0<=d[c].img_id.indexOf(b.img_id)&&(a=!0);a||h.push(b)});$.post($(this).attr("href"),function(a){setTimeout(function(){var a=$(".img-show a");if(e)for(var d=0;d<a.length;d++)for(var b=0;b<h.length;b++)0<=h[b].img_id.indexOf($(a[d]).attr("href"))&&
$(a[d]).parent().parent().addClass("checked")},100)})}});$(".note-image-dialog").on("shown.bs.modal",function(a){$(this).find(".gallery .thumbnail").removeClass("checked");$(this).find(".note-image-url").val("")}).on("click",".action-save",function(){var a=$(".note-image-dialog").find(".checked");a.find("img").attr("src");0<a.length?$(".note-image-dialog").modal("hide"):$("#messagebox").message("请选择图片!")}).on("click",".thumbnail",function(){var a=[];$(this).toggleClass("checked");for(var d=$(this).parents(".modal").find(".checked"),
b=0;b<d.length;b++){var c=$(d[b]).find(".caption").attr("data-url");a.push(c)}$(this).parents(".modal-body").find(".note-image-url").val(a)});$(".multiple-upload").on("click",".multiple-del",function(){$(this).parents(".multiple-upload").find(".multiple-add").show();$(this).parent().remove()})};jQuery(function(){imageUpload()});var left_side_width=220;
$(function(){function a(){var a=$(window).height()-($("body > .header").outerHeight()||0)-($("body > .footer").outerHeight()||0),b=$(".wrapper").height();$(".wrapper").css("min-height",a);$(".left-side, html, body").css("min-height",Math.max(b,a))}$("[data-toggle='offcanvas']").click(function(a){a.preventDefault();992>=$(window).width()?($(".row-offcanvas").toggleClass("active"),$(".left-side").removeClass("collapse-left"),$(".right-side").removeClass("strech"),$(".row-offcanvas").toggleClass("relative")):($(".left-side").toggleClass("collapse-left"),
$(".right-side").toggleClass("strech"))});$(".btn").bind("touchstart",function(){$(this).addClass("hover")}).bind("touchend",function(){$(this).removeClass("hover")});$("[data-toggle='tooltip']").tooltip();$("[data-widget='collapse']").click(function(){var a=$(this).parents(".box").first(),b=a.find(".box-body, .box-footer");a.hasClass("collapsed-box")?(a.removeClass("collapsed-box"),$(this).children(".fa-plus").removeClass("fa-plus").addClass("fa-minus"),b.slideDown()):(a.addClass("collapsed-box"),
$(this).children(".fa-minus").removeClass("fa-minus").addClass("fa-plus"),b.slideUp())});$(".navbar .menu").slimscroll({height:"200px",alwaysVisible:!1,size:"3px"}).css("width","100%");$('.btn-group[data-toggle="btn-toggle"]').each(function(){var a=$(this);$(this).find(".btn").click(function(b){a.find(".btn.active").removeClass("active");$(this).addClass("active");b.preventDefault()})});$("[data-widget='remove']").click(function(){$(this).parents(".box").first().slideUp()});$(".sidebar .treeview").tree();
a();$(window).resize(function(){a();fix_sidebar()});fix_sidebar();$("form:not([novalidate])").Validator({icons:{valid:"icon icon-checkmark-a",invalid:"icon icon-alert",validating:"icon icon-loading-c"}});$("body").on("click",".show-pics a",function(a){a.preventDefault();if(a=$(this).attr("href"))$("#show_img_madal").modal("show"),$("#big_img").attr("src",a);else return!1})});
function fix_sidebar(){$("body").hasClass("fixed")&&$(".sidebar").slimscroll({height:$(window).height()-$(".header").height()+"px",color:"rgba(0,0,0,0.2)"})}
(function(a){a.fn.boxRefresh=function(c){function b(a){a.append(g);d.onLoadStart.call(a)}var d=a.extend({trigger:".refresh-btn",source:"",onLoadStart:function(a){},onLoadDone:function(a){}},c),g=a('<div class="overlay"></div><div class="loading-img"></div>');return this.each(function(){if(""===d.source)console&&console.log("Please specify a source first - boxRefresh()");else{var c=a(this);c.find(d.trigger).first().click(function(a){a.preventDefault();b(c);c.find(".box-body").load(d.source,function(){c.find(g).remove();
d.onLoadDone.call(c)})})}})}})(jQuery);
(function(a){a.fn.tree=function(){return this.each(function(){var c=a(this).children("a").first(),b=a(this).children(".treeview-menu").first(),d=a(this).hasClass("active");d&&(b.show(),c.children(".fa-angle-left").first().removeClass("fa-angle-left").addClass("fa-angle-down"));c.click(function(a){a.preventDefault();d?(b.slideUp(),d=!1,c.children(".fa-angle-down").first().removeClass("fa-angle-down").addClass("fa-angle-left"),c.parent("li").removeClass("active")):(b.slideDown(),d=!0,c.children(".fa-angle-left").first().removeClass("fa-angle-left").addClass("fa-angle-down"),
c.parent("li").addClass("active"))});b.find("li > a").each(function(){var d=parseInt(a(this).css("margin-left"))+10;a(this).css({"margin-left":d+"px"})})})}})(jQuery);
(function(a){jQuery.fn.center=function(c){c=a.extend(!0,{},c);parent=c.parent?this.parent().css("position","relative"):window;this.css({top:"top"===c.top?0:c.top?c.top:(a(parent).height()-this.outerHeight())/2+a(parent).scrollTop()+"px",left:"left"===c.left?0:c.left?c.left:(a(parent).width()-this.outerWidth())/2+a(parent).scrollLeft()+"px"});return this}})(jQuery);
(function(a){a.fn.message=function(c,b,d,g){var f=this;this.data("timer")&&(clearTimeout(this.data("timer")),this.timer=null);this[0].className=this[0].className.replace(/alert-(success|error|warning|info|danger)/g,"");this.html(c).addClass("alert-"+(b||"error"));c=a("header.header").size()?a("header.header").height():"top";this.fadeIn("fast").center({top:c});this.data("timer",setTimeout(function(){f.fadeOut("fast");g&&g()},d||3E3))}})(jQuery);
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):"object"===typeof exports?module.exports=a:a(jQuery)})(function(a){function c(a,b,c){var e="over"==b;a.addEventListener("OverflowEvent"in window?"overflowchanged":b+"flow",function(a){if(a.type==b+"flow"||0==a.orient&&a.horizontalOverflow==e||1==a.orient&&a.verticalOverflow==e||2==a.orient&&a.horizontalOverflow==e&&a.verticalOverflow==e)return a.flow=b,c.call(this,a)},!1)}function b(d){var b=d||window.event,c=[].slice.call(arguments,
1);d=a.event.fix(b);d.type="resize";c.unshift(d);return(a.event.dispatch||a.event.handle).apply(this,c)}a.event.special.resize={setup:function(){var a=this,g="onresize"in a;if(!g&&!a._resizeSensor){var f=a._resizeSensor=document.createElement("div");f.className="resize-sensor";f.innerHTML='<div class="resize-overflow"><div></div></div><div class="resize-underflow"><div></div></div>';var e=0,h=0,n=f.firstElementChild.firstChild,q=f.lastElementChild.firstChild,p=function(b){var c=!1,g=a.offsetWidth;
e!=g&&(n.style.width=g-1+"px",q.style.width=g+1+"px",c=!0,e=g);g=a.offsetHeight;h!=g&&(n.style.height=g-1+"px",q.style.height=g+1+"px",c=!0,h=g);if(c&&b.currentTarget!=a){b={};c=document.createEvent("Event");c.initEvent("resize","bubbles"in b?b.bubbles:!0,"cancelable"in b?b.cancelable:!0);for(var f in void 0)c[f]=(void 0)[f];a.dispatchEvent(c)}};"static"==getComputedStyle(a).position&&(a.style.position="relative",a._resizeSensor._resetPosition=!0);c(f,"over",p);c(f,"under",p);c(f.firstElementChild,
"over",p);c(f.lastElementChild,"under",p);a.appendChild(f);p({})}var l=a._flowEvents||(a._flowEvents=[]);-1==l.indexOf(b)&&l.push(b);g||a.addEventListener("resize",b,!1);a.onresize=function(b){l.forEach(function(c){c.call(a,b)})}},teardown:function(){var a=this._flowEvents.indexOf(b);-1<a&&this._flowEvents.splice(a,1);if(!this._flowEvents.length){if(a=this._resizeSensor)this.removeChild(a),a._resetPosition&&(this.style.position="static"),delete this._resizeSensor;"onresize"in this&&(this.onresize=
null);delete this._flowEvents}this.removeEventListener("resize",b)}};a.fn.extend({resize:function(a){return a?this.bind("resize",a):this.trigger("resize")},unresize:function(a){return this.unbind("resize",a)}})});
(function(a){jQuery.fn.extend({slimScroll:function(c){var b=a.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:0.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"0px",railBorderRadius:"0px"},c);this.each(function(){function d(d){if(q){d=d||
window.event;var c=0;d.wheelDelta&&(c=-d.wheelDelta/120);d.detail&&(c=d.detail/3);a(d.target||d.srcTarget||d.srcElement).closest("."+b.wrapperClass).is(k.parent())&&g(c,!0);d.preventDefault&&!s&&d.preventDefault();s||(d.returnValue=!1)}}function g(a,d,c){s=!1;var e=a,g=k.outerHeight()-m.outerHeight();d&&(e=parseInt(m.css("top"))+a*parseInt(b.wheelStep)/100*m.outerHeight(),e=Math.min(Math.max(e,0),g),e=0<a?Math.ceil(e):Math.floor(e),m.css({top:e+"px"}));x=parseInt(m.css("top"))/(k.outerHeight()-m.outerHeight());
e=x*(k[0].scrollHeight-k.outerHeight());c&&(e=a,a=e/k[0].scrollHeight*k.outerHeight(),a=Math.min(Math.max(a,0),g),m.css({top:a+"px"}));k.scrollTop(e);k.trigger("slimscrolling",~~e);h();n()}function f(){window.addEventListener?(this.addEventListener("DOMMouseScroll",d,!1),this.addEventListener("mousewheel",d,!1),this.addEventListener("MozMousePixelScroll",d,!1)):document.attachEvent("onmousewheel",d)}function e(){v=Math.max(k.outerHeight()/k[0].scrollHeight*k.outerHeight(),z);m.css({height:v+"px"});
var a=v==k.outerHeight()?"none":"block";m.css({display:a})}function h(){e();clearTimeout(r);x==~~x?(s=b.allowPageScroll,B!=x&&k.trigger("slimscroll",0==~~x?"top":"bottom")):s=!1;B=x;v>=k.outerHeight()?s=!0:(m.stop(!0,!0).fadeIn("fast"),b.railVisible&&y.stop(!0,!0).fadeIn("fast"))}function n(){b.alwaysVisible||(r=setTimeout(function(){b.disableFadeOut&&q||p||l||(m.fadeOut("slow"),y.fadeOut("slow"))},1E3))}var q,p,l,r,w,v,x,B,z=30,s=!1,k=a(this);if(k.parent().hasClass(b.wrapperClass)){var u=k.scrollTop(),
m=k.parent().find("."+b.barClass),y=k.parent().find("."+b.railClass);e();if(a.isPlainObject(c)){if("height"in c&&"auto"==c.height){k.parent().css("height","auto");k.css("height","auto");var A=k.parent().parent().height();k.parent().css("height",A);k.css("height",A)}if("scrollTo"in c)u=parseInt(b.scrollTo);else if("scrollBy"in c)u+=parseInt(b.scrollBy);else if("destroy"in c){m.remove();y.remove();k.unwrap();return}g(u,!1,!0)}}else b.height="auto"==b.height?k.parent().height():b.height,u=a("<div></div>").addClass(b.wrapperClass).css({position:"relative",
overflow:"hidden",width:b.width,height:b.height}),k.css({overflow:"hidden",width:b.width,height:b.height}),y=a("<div></div>").addClass(b.railClass).css({width:b.size,height:"100%",position:"absolute",top:0,display:b.alwaysVisible&&b.railVisible?"block":"none","border-radius":b.railBorderRadius,background:b.railColor,opacity:b.railOpacity,zIndex:90}),m=a("<div></div>").addClass(b.barClass).css({background:b.color,width:b.size,position:"absolute",top:0,opacity:b.opacity,display:b.alwaysVisible?"block":
"none","border-radius":b.borderRadius,BorderRadius:b.borderRadius,MozBorderRadius:b.borderRadius,WebkitBorderRadius:b.borderRadius,zIndex:99}),A="right"==b.position?{right:b.distance}:{left:b.distance},y.css(A),m.css(A),k.wrap(u),k.parent().append(m),k.parent().append(y),b.railDraggable&&m.bind("mousedown",function(d){var b=a(document);l=!0;t=parseFloat(m.css("top"));pageY=d.pageY;b.bind("mousemove.slimscroll",function(a){currTop=t+a.pageY-pageY;m.css("top",currTop);g(0,m.position().top,!1)});b.bind("mouseup.slimscroll",
function(a){l=!1;n();b.unbind(".slimscroll")});return!1}).bind("selectstart.slimscroll",function(a){a.stopPropagation();a.preventDefault();return!1}),y.hover(function(){h()},function(){n()}),m.hover(function(){p=!0},function(){p=!1}),k.hover(function(){q=!0;h();n()},function(){q=!1;n()}),k.bind("touchstart",function(a,d){a.originalEvent.touches.length&&(w=a.originalEvent.touches[0].pageY)}),k.bind("touchmove",function(a){s||a.originalEvent.preventDefault();a.originalEvent.touches.length&&(g((w-a.originalEvent.touches[0].pageY)/
b.touchScrollStep,!0),w=a.originalEvent.touches[0].pageY)}),e(),"bottom"===b.start?(m.css({top:k.outerHeight()-m.outerHeight()}),g(0,!0)):"top"!==b.start&&(g(a(b.start).position().top,null,!0),b.alwaysVisible||m.hide()),f()});return this}});jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);
(function(a){if(!window.localStorage||!window.JSON)return a.fn.rememberState=function(){return this};var c={name:"rememberState",clearOnSubmit:!0,ignore:null,use_ids:!1,mark:null,restoreState:function(a){var b=JSON.parse(localStorage.getItem(this.mark)),c=this.$el,e,h;for(h in b)e=c.find('[name="'+b[h].name+'"]'),e.is(":radio")?e.filter('[value="'+b[h].value+'"]').prop("checked",!0):e.is(":checkbox")&&b[h].value?e.prop("checked",!0):e.is("select")?e.find('[value="'+b[h].value+'"]').prop("selected",
!0):e.val(b[h].value),e.change();a&&a.preventDefault&&a.preventDefault()},saveState:function(d){d=d.data.instance;var c=d.$el.serializeArray();d.$el.find("input[type='datetime-local']").each(function(){var b=a(this);c.push({name:b.attr("name"),value:b.val()})});c=d.removeIgnored(c);c.length&&b.setObject(d.mark,c)},save:function(){var a=this;this.saveState||(a=this.data(c.name));a.saveState({data:{instance:a}})},removeIgnored:function(b){var c=this.ignore;if(!c)return b;a.each(b,function(f,e){-1!==
a.inArray(e.name,c)&&(b[f]=!1)});return b=a.grep(b,function(a){return a})},setName:function(){(this.mark=this.mark||this.$el.attr("id"))||console.warn("No form ID or other mark.");this.mark="rememberstate_"+this.mark},bindResetEvents:function(){var b=this;this.clearOnSubmit&&this.$el.bind("submit."+this.name,function(){a(this).trigger("reset_state");a(window).unbind("unload."+b.name)});this.$el.bind("reset_state."+this.name,function(){localStorage.removeItem(b.mark)});this.$el.find(":reset").bind("click."+
this.name,function(){a(this).closest("form").trigger("reset_state")})},destroy:function(b){var c="."+this.name;this.$el.unbind(c).find(":reset").unbind(c);a(window).unbind(c);b&&localStorage.removeItem(this.mark)},init:function(){this.setName();this.mark&&(this.bindResetEvents(),a(window).bind("unload."+this.name,{instance:this},this.saveState))}},b={setObject:function(a,b){localStorage[a]=JSON.stringify(b)},getObject:function(a){return JSON.parse(localStorage[a])},createPlugin:function(b){a.fn[b.name]=
function(c){var f=this,e=a.isPlainObject(c)||!c?"":c,h=arguments;e&&b[e]?f.each(function(a){b[e].apply(f.eq(a).data(b.name),Array.prototype.slice.call(h,1))}):e?a.error("Method "+e+" does not exist on jQuery."+b.name):f.each(function(e){var h=a.extend(!0,{$el:f.eq(e)},b,c);f.eq(e).data(b.name,h);h.init()});return f}}};b.createPlugin(c)})(jQuery);var goodsChoose=function(a){a=$.extend({url:"",getProUrl:"",getBrandUrl:"",getGoodsUrl:"",target:document.body,modalDom:"#goods_modal",handle:".select-goods",catBox:".goods-category",catlistItem:".goods-category li",catDefault:"分类",brandBox:".goods-brands",brandList:"#brand_list",brandListItem:"#brand_list li",brandDefault:"品牌",filterBtn:"#search_goods",skuFilterBtn:"#sku_search_goods",clearFilterBtn:"#clear_filter",clearBrandBtn:"#clear_brand",submitBtn:"#choose_goods",skuSubmitBtn:"#sku_choose_goods",
checkAll:"#check_all",uncheckAll:"#uncheck_all",goodsList:"#goods_list",skuList:"#sku_list",goodsListItem:"#goods_list > ul > li",skuListItem:"#sku_list > ul > li",goodsSearchKey:".goods-search-key",goodsSearchBn:".goods-search-bn",goodsSearchBrand:".goods-search-brand",insertWhere:null,textcol:null,view:null,getPro:function(a,b,c,d,f,g,h,n){$.ajax({url:b,type:"POST",dataType:"html",data:{searchname:f,searchbn:g,searchbrand:h,catId:c,brandId:d},success:function(b){$(a).html(b);b=$(a).find("li");for(var c=
0;c<b.length;c++)for(var d=$(b[c]).attr("data-id"),f=0;f<e.length;f++)d==e[f]&&$(b[c]).addClass("checked");if(n)return n()}})}},a||{});var c,b,d,g,f,e=[],h=$(a.handle).attr("data-remote")||a.url,n=$(a.handle).attr("data-item_id"),q=$(a.handle).attr("data-fetchgoods")||a.getGoodsUrl,p=$(a.insertWhere||".selected-goods-list");limit=$(a.handle).data("limit")||a.limit;$(a.target).on("click",a.handle,function(b){b.preventDefault();b=$(this).parents(".select-goods-panel");p=$(b).find(this.getAttribute("data-insertwhere")||
a.insertWhere||".selected-goods-list");$(this).attr("data-modal")?$($(this).attr("data-modal")).modal("show"):$(a.modalDom).modal("show")});$(a.handle).each(function(){var l=$(this);f=$(this).data();for(var r in f)"remote"===r&&delete f[r],"fetchgoods"===r&&delete f[r],"target"===r&&delete f[r],"limit"===r&&delete f[r];n=$(this).attr("data-item_id");q=$(this).attr("data-fetchgoods")||a.getGoodsUrl;n&&0<n.length&&$.post(q,f,function(b){b&&(p=l.parents(".select-goods-panel").find(a.insertWhere||".selected-goods-list"),
$(p).html(b))});$($(this).attr("data-modal")||a.modalDom).on("show.bs.modal",function(){p=l.parents(".select-goods-panel").find(a.insertWhere||".selected-goods-list");limit=l.data("limit")||a.limit;e=[];var b=$(p).find("tr");l.attr("data-modal")&&"#sku_modal"==l.attr("data-modal")&&(b=$(p).find(".sku-item"));$(b).each(function(a,b){e.push($(b).attr("date-itemid"))});h=l.attr("data-remote")||a.url;$(this).find(".modal-content").load(h)}).on("shown.bs.modal",function(){n=l.attr("data-item_id");q=l.attr("data-fetchgoods")||
a.getGoodsUrl;l.attr("data-modal")&&"#sku_modal"==l.attr("data-modal")?(g=a.skuList,c=$(a.skuFilterBtn).attr("data-remote")||a.getProUrl):(g=a.goodsList,c=$(a.filterBtn).attr("data-remote")||a.getProUrl);a.getPro(g,c,"","","","","",function(){for(var a=$(g).find("li"),b=0;b<a.length;b++)for(var c=$(a[b]).attr("data-id"),d=0;d<e.length;d++)c==e[d]&&$(a[b]).addClass("checked")})}).on("hide.bs.modal",function(){a.getPro(g,c)}).on("click",a.catlistItem,function(a){a.stopPropagation();$(this).attr("data-val")&&
(b=$(this).attr("data-val"),a=$(this).children("span").text(),$(this).parents(".filters-list").hide().siblings(".filter-name").text(a))}).on("click",a.brandListItem,function(){d=$(this).attr("data-val");var a=$(this).text();$(this).parents(".filters-list").hide().siblings(".filter-name").text(a)}).on("click",a.filterBtn+","+a.skuFilterBtn,function(){var f=$(this).parent().find('input[name="item_title"]').val(),h=$(this).parent().find('input[name="item_bn"]').val(),l=$(this).parent().find('input[name="item_brand"]').val();
a.getPro(g,c,b,d,f,h,l,function(){for(var a=$(g).find("li"),b=0;b<a.length;b++)for(var c=$(a[b]).attr("data-id"),d=0;d<e.length;d++)c==e[d]&&$(a[b]).addClass("checked")})}).on("click",a.goodsListItem+","+a.skuListItem,function(){$(this).toggleClass("checked");var a=$(this).data("id");if($(this).hasClass("checked")){if(limit){if("number"===typeof limit&&0<parseInt(limit))limit=parseInt(limit);else return;if($(this).parent().parent().find(".checked").length>limit){$("#messagebox").message("最多只能选择"+
limit+"个商品");$(this).removeClass("checked");return}}e.push(a)}else for(var b=0;b<e.length;b++)e[b]==a&&e.splice(b,1)}).on("click",a.checkAll,function(){var b=l.attr("data-modal")&&"#sku_modal"==l.attr("data-modal")?$(a.skuListItem):$(a.goodsListItem),c=[];b.addClass("checked");for(var d=0;d<b.length;d++){var f=$(b[d]).data("id");c.push(f)}e=$.unique($.merge(e,c))}).on("click",a.uncheckAll,function(){var b=l.attr("data-modal")&&"#sku_modal"==l.attr("data-modal")?$(a.skuListItem):$(a.goodsListItem),
c=[];b.removeClass("checked");for(var d=e.concat(),f=0;f<b.length;f++){var g=$(b[f]).data("id");c.push(g)}for(f=0;f<d.length;f++)for(b=0;b<c.length;b++)if(d[f]==c[b]){e.splice(0,1);break}}).on("mouseover mouseout",a.catBox,function(a){var b=$(this).children(".filters-list");"mouseover"==a.type?b.show():"mouseout"==a.type&&b.hide()}).on("mouseover mouseout",a.brandBox,function(a){var b=$(this).children(".filters-list");"mouseover"==a.type?b.show():"mouseout"==a.type&&b.hide()}).on("mouseover mouseout",
a.catlistItem,function(a){var b=$(this).children(".child-list");$(b)&&("mouseover"==a.type?b.show():"mouseout"==a.type&&b.hide())}).on("click",a.clearFilterBtn,function(e){e.preventDefault();d=b=null;$(a.catBox).find(".filter-name").text(a.catDefault);$(a.brandBox).find(".filter-name").text(a.brandDefault);$(a.brandList).empty();$(a.goodsSearchKey).val("");$(a.goodsSearchBn).val("");$(a.goodsSearchBrand).val("");c=$(a.filterBtn).attr("data-remote")||a.getProUrl;l.attr("data-modal")&&"#sku_modal"==
l.attr("data-modal")&&(c=$(a.skuFilterBtn).attr("data-remote")||a.getProUrl);a.getPro(g,c,"","","","",function(){})}).on("click",a.clearBrandBtn,function(b){b.preventDefault();d=null;$(a.brandBox).find(".filter-name").text(a.brandDefault)}).on("click",a.submitBtn+","+a.skuSubmitBtn,function(){if(0==e.length)$("#messagebox").message("请选择商品");else if(l.attr("data-modal")&&"#sku_modal"==l.attr("data-modal")&&4<e.length)$("#messagebox").message("最多只能添加4件赠品");else{var b={item_id:e};f=l.data();f=$.extend(f,
b);$.post(q,f,function(b){b?($(p).html(b),$(l.attr("data-modal")||a.modalDom).modal("hide")):$("#messagebox").message("还未添加商品")})}}).on("click",".pagination a",function(a){a.preventDefault();$(this).parent().hasClass("disabled")||$.post($(this).attr("href"),function(a){$(g).html(a);a=$(g).find("li");for(var b=0;b<a.length;b++)for(var c=$(a[b]).attr("data-id"),d=0;d<e.length;d++)c==e[d]&&$(a[b]).addClass("checked")})})})};$(function(){goodsChoose()});